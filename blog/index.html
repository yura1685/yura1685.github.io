<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog | yura1685</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>

<header>
    <nav>
        <div class="logo">yura1685's Journal</div>
        <ul>
            <li><a href="../index.html">Home</a></li>
            <li><a href="../articles/index.html">Articles</a></li>
            <li><a href="index.html" class="active">Blog</a></li>
            <li><a href="../atcoder/index.html">AtCoder</a></li>
        </ul>
    </nav>
</header>

<main>
    <nav class="breadcrumb">
        <a href="../index.html">Home</a>
        <span class="breadcrumb-separator">＞</span>
        <span>Blog</span>
    </nav>

    <section class="archive-header">
        <h1>Latest Blog</h1>
        <p>日々の開発記録と、どうでもいいこと。</p>
    </section>

    <div id="tab-container" class="tab-nav"></div>

    <div id="blog-container">
        <div class="loading">Fetching data from spreadsheet...</div>
    </div>
</main>

<footer>
    <p>&copy; 2026 yura1685</p>
</footer>

<script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRvW2DrRQWYruMIFZxdCcyma3Hp-bDMKP_Y860hJaJWBvdGP2Hli-KnCdABHL-sq30BlcO5CMr8-3x1/pub?gid=0&single=true&output=csv";

    async function loadData() {
        try {
            const response = await fetch(CSV_URL);
            const csvText = await response.text();
            
            const re = /("(?:[^"]|"")*"|[^,\r\n]*)(,|\r?\n|\r)/g;
            let rows = [];
            let currentRow = [];
            let match;
            while ((match = re.exec(csvText + '\n')) !== null) {
                let value = match[1];
                if (value.startsWith('"') && value.endsWith('"')) {
                    value = value.substring(1, value.length - 1).replace(/""/g, '"');
                }
                currentRow.push(value);
                if (match[2] !== ',') {
                    rows.push(currentRow);
                    currentRow = [];
                }
            }
            rows.shift(); // 見出し行を削除

            const postsByMonth = {};
            rows.forEach(cols => {
                if (cols.length < 2 || !cols[0]) return;
                const dateStr = cols[0].trim();
                const content = cols[1].trim();
                const month = dateStr.substring(0, 7); // YYYY/MM

                if (!postsByMonth[month]) postsByMonth[month] = [];
                postsByMonth[month].push({ date: dateStr, content: content });
            });

            renderInterface(postsByMonth);
        } catch (error) {
            document.getElementById('blog-container').innerText = "Failed to load log.";
            console.error(error);
        }
    }

    function renderInterface(postsByMonth) {
        const tabContainer = document.getElementById('tab-container');
        const blogContainer = document.getElementById('blog-container');
        tabContainer.innerHTML = "";
        blogContainer.innerHTML = "";

        const months = Object.keys(postsByMonth).sort().reverse();

        months.forEach((month, index) => {
            const btn = document.createElement('button');
            btn.className = `tab-button ${index === 0 ? 'active' : ''}`;
            btn.innerText = month;
            btn.onclick = () => switchTab(month, btn);
            tabContainer.appendChild(btn);

            const monthDiv = document.createElement('div');
            monthDiv.id = `group-${month}`;
            monthDiv.className = `month-group ${index === 0 ? 'active' : ''}`;

            postsByMonth[month].reverse().forEach(post => {
                const postEl = document.createElement('div');
                postEl.className = 'post';
                postEl.innerHTML = `
                    <div class="post-date">${post.date}</div>
                    <div class="post-content">${post.content}</div>
                `;
                monthDiv.appendChild(postEl);
            });
            blogContainer.appendChild(monthDiv);
        });
    }

    function switchTab(month, clickedBtn) {
        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.month-group').forEach(div => div.classList.remove('active'));
        clickedBtn.classList.add('active');
        document.getElementById(`group-${month}`).classList.add('active');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    loadData();
</script>

</body>
</html>
